(function(a){a.Manager=function(e){var c={},b=$.extend({id:"container",components:{}},e),d={};var g;function f(){g=$("#isepta-dialog");$(".nxs-dialog-open").click(function(){g.css("top",window.scrollY+8);g.show();return false});$(".close",g).click(function(){g.hide()})}c.getPath=function(j){var i="";var h=["routeType","routeId","direction","from","to"];$.each(h,function(l,k){if(d[k]){i+="/"+d[k];return true}return false});if(j){i+="/"+j}return i};c.init=function(){var h=$("#content");d={routeType:h.attr("data-type"),routeId:h.attr("data-route"),direction:h.attr("data-direction"),from:h.attr("data-from"),to:h.attr("data-to")};$.each(b.components,function(i,j){j.init(c,d)});f();return c};return c}})(NextSepta);(function(a){a.Stops=function(n){var k={},l={id:"stops",target:"#content"},d,c,b=[],o=null;var h=[{l:"week",s:604800},{l:"day",s:86400},{l:"hr",s:3600},{l:"min",s:60}];var i;function m(r){if(r<0){return"(GONE)"}else{if(r<60){return"(< 1 min)"}else{var q="",p=0;$.each(h,function(t,s){if(r>s.s){p=Math.floor(r/s.s);if(q){q+=" "}q+=p+" "+s.l+(p==1?"":"s");r=r%s.s}});return"("+q+")"}}}function e(){var p=new Date();$.each(b,function(r,q){var s=(q.time-p)/1000;q.el.html(m(s))});if(b.length){setTimeout(function(){e()},25000)}}function f(){$(".nxs-stoptime").each(function(){var q=$(this).attr("data-block"),s=$(this).attr("data-trip");if(q&&q in o){var p=o[q];var r=d.getPath("map?bus="+p.VehicleID+"&trip="+s);$(".nxs-stoptime-aside",this).html('<a href="'+r+'">map</a>')}})}function g(p){a.Data.get("/locations/"+p,function(q){o={};if(q.bus){$.each(q.bus,function(s,r){o[r.BlockID]=r})}f()})}function j(){var q=0;var p={"0":{$first:$("li:first",i)}};$(".nxs-stoptimes-pager").click(function(){var r=$(this).attr("data-dir")==="fwd";var s=q.toString();q+=r?5:-5;var t=q.toString();if(t in p){i.scrollTo(p[t].$first,500)}else{a.Data.get(window.location.pathname,function(w){if(w&&w.length){var u=a.template(a.Templates.stopTime,{stop_times:w});var v;if(q<0){i.prepend(u);i.scrollTo(p[s].$first)}else{i.append(u)}if(c.routeType="buses"){f()}v=$("li[data-trip="+w[0].trip_id+"]",i);i.scrollTo(v,500);p[t]={$first:v}}else{q=parseInt(s,10)}},null,{offset:q})}})}k.init=function(p,q){d=p;c=q;i=$("#times-list");i.height(i.height());j();$(".nxs-stoptime-left").each(function(){var s=$("time",this).attr("datetime"),t=$("span",this);if(s){var r=new Date(Date.parse(s));if(r&&!$.isNaN(r)){b.push({time:r,el:t})}}});if(c.routeType==="buses"&&c.routeId){g(c.routeId)}e();return k};return k}})(NextSepta);NextSepta.Templates.stopTime=["{{#stop_times}}",'<li class="nxs-stoptime" data-block="{{block_id}}" data-trip="{{trip_id}}">','<div class="nxs-stoptime-left{{^arrival_stop_time}} nxs-stoptime-nodest{{/arrival_stop_time}}">',"<time>{{departure_time_formatted}}</time>",'<span data-time="{{departure_time}}">({{from_now}})</span>',"</div>","{{#arrival_stop_time}}",'<div class="nxs-stoptime-right">',"<time>{{arrival_time_formatted}}</time>","</div>","{{/arrival_stop_time}}",'<div class="nxs-stoptime-aside"></div>',"</li>","{{/stop_times}}"].join("");